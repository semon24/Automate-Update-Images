name: Run Nomad Job

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Submit Job to Nomad via API
        env:
          NOMAD_ADDR: "http://45.86.183.34:4646"
          NOMAD_TOKEN: ${{ secrets.NOMAD_TOKEN }}
        run: |
          curl -v -X POST \
            -H "X-Nomad-Token: $NOMAD_TOKEN" \
            -H "Content-Type: text/plain" \
            --data-binary @./jobs/example_jobs.hcl \
            "$NOMAD_ADDR/v1/jobs"
